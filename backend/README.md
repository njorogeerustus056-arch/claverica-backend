# Claverica Backend API

Django REST API backend for Claverica payment and escrow platform, fully hosted on Render (backend + database).

## ğŸ—ï¸ Tech Stack

- **Framework**: Django 5.2.7 + Django REST Framework
- **Database**: PostgreSQL (Render)
- **Authentication**: JWT (Simple JWT)
- **Hosting**: Render (Web Service + PostgreSQL)
- **Server**: Gunicorn

## ğŸš€ Quick Start

### Local Development

1. **Install dependencies**
```bash
pip install -r requirements.txt
```

2. **Set up environment**
```bash
cp .env.example .env
# Edit .env with your credentials
```

3. **Run migrations**
```bash
python manage.py migrate
python manage.py createsuperuser
```

4. **Start server**
```bash
python manage.py runserver
```

Visit: http://localhost:8000

## ğŸŒ Production (Render)

1. Push code to GitHub
2. Connect to Render
3. Render automatically:
   - Creates PostgreSQL database
   - Sets DATABASE_URL environment variable
   - Runs migrations
   - Deploys your app
4. Done! âœ…

Backend URL: https://claverica-backend.onrender.com

## ğŸ“¡ API Endpoints

### Authentication
- **POST** `/api/token/` - Login (get JWT tokens)
- **POST** `/api/token/refresh/` - Refresh access token

### Resources
- **GET** `/api/accounts/` - List accounts
- **GET** `/api/payments/` - List payments
- **GET** `/api/escrow/` - List escrow transactions
- **GET** `/api/transactions/` - List transactions

### System
- **GET** `/` - API info
- **GET** `/health/` - Health check
- **GET** `/admin/` - Admin panel

## ğŸ” Authentication

All endpoints require JWT Bearer token:
```bash
# Login
curl -X POST https://claverica-backend.onrender.com/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password"}'

# Use token
curl https://claverica-backend.onrender.com/api/accounts/ \
  -H "Authorization: Bearer <your-access-token>"
```

## ğŸ“¦ File Uploads

Files are stored in Render's `/media/` directory. For persistent storage across deployments, consider:
- Cloudinary (images)
- AWS S3 (documents)
- Render Disks (paid feature)

## ğŸ”§ Environment Variables (Render Dashboard)

Required:
- `DJANGO_SECRET_KEY` - Auto-generated by Render
- `DEBUG` - Set to `False`
- `DATABASE_URL` - Auto-provided by Render

Optional:
- `DJANGO_LOG_LEVEL` - Default: `INFO`

## ğŸ“Š Database

Render automatically provisions a PostgreSQL database and sets the `DATABASE_URL` environment variable. No manual configuration needed!

## ğŸ†˜ Troubleshooting

**Issue**: CORS errors from frontend
**Solution**: Add your frontend URL to `CORS_ALLOWED_ORIGINS` in `settings.py`

**Issue**: 400 Bad Request
**Solution**: Add your frontend domain to `ALLOWED_HOSTS` and `CSRF_TRUSTED_ORIGINS`

**Issue**: Database connection failed
**Solution**: Verify PostgreSQL database is created and linked in Render dashboard

**Issue**: Static files not loading
**Solution**: Run `python manage.py collectstatic` (done automatically in build.sh)
